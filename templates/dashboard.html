{% extends "base.html" %}

{% block additional_head %}
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="/static/js/d3.layout.cloud.js"></script>

    <script async src="https://platform.twitter.com/widgets.js"></script>
{% endblock %}

{% block content %}
    <style>
        body {
            padding-top: 80px;
        }

        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }

        .row {
            margin: 20px 0;
        }

        ul {
            text-align: left;
        }

        .company-logo {
            display: block;
            margin: auto;
            max-width: 130px;
            max-height: 130px;
        }
    </style>

    <div id="fb-root"></div>
    <script>(function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <div class="row">
        <div class="col-md-4">
            <img class="company-logo" src="{{ wiki.image }}">
        </div>

        <div class="col-md-8">
            <h4>{{ wiki.name }}</h4>
            <p>{{ wiki.article }}</p>
            Link to Wikipedia:
            <a href="{{ wiki.url }}">{{ wiki.url }}</a>
        </div>
    </div>

    <!-- TradingView Widget BEGIN -->
    <div class="row">
        <div class="col-xs-12">
            <div id="hi-man"></div>
        </div>
    </div>

    <script type="text/javascript" src="https://d33t3vvu2t2yu5.cloudfront.net/tv.js"></script>
    <script type="text/javascript">
        new TradingView.MediumWidget({
            "container_id": "hi-man",
            "symbols": [
                [
                    "{{ company_name }}",
                    "{{ ticker }}"
                ]
            ],
            "gridLineColor": "#e9e9ea",
            "fontColor": "#83888D",
            "underLineColor": "#dbeffb",
            "trendLineColor": "#4bafe9",
            "width": "100%",
            "height": "350px",
            "locale": "en"
        });
    </script>
    <!-- TradingView Widget END -->

    <!-- News & Summarization Widget -->
    <div class="row">
        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <span class="glyphicon glyphicon-menu-up"></span>
                        Relevant News Media
                        <span class="glyphicon glyphicon-remove pull-right"></span>
                    </div>
                </div>
                <div class="panel-body">
                    {% for article in result %}
                        <div class="media">
                            <div class="media-left">
                                <a href="{{ article.url }}">
                                    <img style="max-width: 96px; max-height: 96px" class="media-object"
                                         src="{{ article.image or "http://www.oneilllogistics.com/content/images/news.png" }}"
                                    >
                                </a>
                            </div>
                            <div class="media-body">
                                <a href="{{ article.url }}">
                                    <h4 class="media-heading">{{ article.title }}</h4>
                                </a>
                                <p style="color: darkgrey;"> Sources: {{ article.domain }} </p>
                                <ul>
                                    {% for point in article.points %}
                                        <li>{{ point }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <span class="glyphicon glyphicon-menu-up"></span>
                        Word Cloud
                        <span class="glyphicon glyphicon-remove pull-right"></span>
                    </div>
                </div>
                <div class="panel-body">
                    <div id="wordcloud"></div>
                </div>
            </div>
        </div>


        {#  left column #}

        <!-- Social Mention Widget -->
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <span class="glyphicon glyphicon-menu-up"></span>
                        Relevant Stock Tickers
                        <span class="glyphicon glyphicon-remove pull-right"></span>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="list-group">
                        {% for i, j in relevant_t_c %}
                            <a href="{{ url_for('summarize', ticker = i) }}" class="list-group-item ">
                                {{ i + ": " +j }}
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>


            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <span class="glyphicon glyphicon-menu-up"></span>
                        Social Mentions in Twitter
                        <span class="glyphicon glyphicon-remove pull-right"></span>
                    </div>
                </div>
                <div class="panel-body" style="overflow-y: scroll; height:400px;">
                    {% for t in social_tweets %}
                        <blockquote class="twitter-tweet">
                            <a href="https://twitter.com/{{ t.screen_name }}/status/{{ t.id }}">...</a>
                        </blockquote>
                    {% endfor %}
                </div>
            </div>


            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <span class="glyphicon glyphicon-menu-up"></span>
                        Facebook Page
                        <span class="glyphicon glyphicon-remove pull-right"></span>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="fb-page" data-href="https://www.facebook.com/apple/" data-tabs="timeline"
                         data-small-header="false" data-adapt-container-width="true" data-hide-cover="false"
                         data-show-facepile="true">
                        <blockquote cite="https://www.facebook.com/apple/" class="fb-xfbml-parse-ignore"><a
                                href="https://www.facebook.com/apple/">APPLE</a></blockquote>
                    </div>
                </div>
            </div>


        </div>


    </div>

    <script>
        $(function () {
            $('.panel-heading').on("click", function (e) {
                if ($(this).hasClass('panel-collapsed')) {
                    $(this).parents('.panel').find('.panel-body').slideDown();
                    $(this).removeClass('panel-collapsed');
                    $(this).find('span.glyphicon-menu-down').removeClass('glyphicon-menu-down').addClass('glyphicon-menu-up');
                } else {
                    $(this).parents('.panel').find('.panel-body').slideUp();
                    $(this).addClass('panel-collapsed');
                    $(this).find('span.glyphicon-menu-up').removeClass('glyphicon-menu-up').addClass('glyphicon-menu-down');
                }
            });
            $('.glyphicon-remove').on('click', function () {
                $(this).parents('.panel').fadeOut();
            })
        });
    </script>


    <script>
        var enclosing_div = document.getElementById('wordcloud');
        var container_width = enclosing_div.clientWidth;

        var frequency_list = {{ wordcloud|tojson }};

        var color = d3.scale.linear()
            .domain([0, 1, 2, 3, 4, 5, 6, 10, 15, 20, 100])
            .range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);

        d3.layout.cloud().size([container_width - 50, 400 - 50])
            .words(frequency_list)
            .rotate(0)
            .fontSize(function (d) {
                return d.size;
            })
            .on("end", draw)
            .start();

        function draw(words) {
            d3.select("#wordcloud").append("svg")
                .attr("width", container_width)
                .attr("height", 400)
                .attr("class", "wordcloud")
                .append("g")
                // without the transform, words words would get cutoff to the left and top, they would
                // appear outside of the SVG area
                .attr("transform", "translate(" + (container_width / 2 - 80) + ", 200)")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function (d) {
                    return d.size + "px";
                })
                .style("fill", function (d, i) {
                    return color(i);
                })
                .attr("transform", function (d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function (d) {
                    return d.text;
                });
        }
    </script>
{% endblock %}